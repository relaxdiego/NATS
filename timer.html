<html>
<head>
<script type="text/javascript">
  //
  // N.A.T.S. = Neo-Analytic Time Sequencer!
  // Licensed under the Creative Commons Attribution 3.0 License
  // See README.rdoc for more information
  //
  
  var NATS = {}; // Create a 'namespace' for this script. Because I'm OC like that ;-)
  
  NATS.talkLength       = 15;   // Expected length of the talk in minutes
  NATS.timeToWarn       = 13;   // Time in minutes when warning signal is displayed
  
  // EXAMPLE: (assuming count up is true)
  // talkLength of 15 and timeToWarn of 13 means that
  // the warning signal will be shown at 13:00 and the overtime 
  // signal will be shown at 15:00. If you want to specify any of
  // the two values in seconds instead, just say x/60 where x is
  // the time in seconds. For instance, a timeToWarn of 5/60 means
  // the warning signal will be displayed at 00:05
  
  /*******************************************************************
     WARNING NI DODONG:
     DO NOT CHANGE ANYTHING BELOW UNLESS YOU ARE NATSKY, MARK, 
     GEORGE, OR YOU KNOW WHAT YOU'RE DOING! HEE HEE HEE.
  *******************************************************************/
  
  NATS.countUp     = true;
  NATS.elapsedTime = 0;         // milliseconds elapsed since time start
  NATS.paused      = true;
  NATS.startTime   = null;
  NATS.showMilliseconds = true; // Ooooooh, what does this button do?
    
  NATS.initialize = function() {
    window.removeEventListener("load", NATS.initialize, false);
    
    document.addEventListener("keydown", NATS.handleKey, false);
    document.getElementById("start").addEventListener("click", NATS.start, false);
    document.getElementById("pause").addEventListener("click", NATS.pause, false);
    document.getElementById("direction").addEventListener("change", NATS.setDirection, false);
    document.getElementById("reset").addEventListener("click", NATS.reset, false);
    
    NATS.body        = document.getElementsByTagName("body")[0];
    NATS.directionEl = document.getElementById("direction");
    NATS.counterDiv  = document.getElementById("counter");
    NATS.milsDiv     = document.getElementById("milliseconds");
    NATS.reset();
  }

  NATS.handleKey = function(event){
    switch(event.keyCode){
      case 83: if(NATS.paused) NATS.start(); break;                                                // S
      case 80: if(!NATS.paused && confirm("Are you sure you want to pause?")) NATS.pause(); break; // P
      case 27: if(confirm("Are you sure you want to reset?")) NATS.reset(); break;                 // ESC
      case 68: NATS.toggleDirection(); break;                                                      // D
      case 77: NATS.showMilliseconds = !NATS.showMilliseconds; NATS.redraw(); break;               // M
    }
  }

  NATS.pad = function(num){
    if(num < 10) return '0' + num;
    return num;
  }
  
  NATS.pause = function(){
    clearInterval(NATS.timer);
    NATS.paused = true;
    NATS.redraw();
  }

  NATS.redraw = function(){
    var timeLeft = NATS.talkLength * 60000 - NATS.elapsedTime;
    var time     = NATS.countUp ? NATS.elapsedTime : Math.abs(timeLeft); 
    
    // Redraw the counter
    NATS.counterDiv.innerHTML = (!NATS.countUp && timeLeft < 0 ? "-" : "") + NATS.pad(Math.floor(time/60000)) + ":" + NATS.pad(Math.floor((time%60000)/1000));
    NATS.redrawMils(time);
    
    // Update status of the timer
    var c = "";
    if(NATS.paused){ 
      c += "paused "; 
    } else { 
      c += "counting ";
      if(NATS.elapsedTime > (NATS.timeToWarn * 60000)) c += "warning ";
      if(NATS.elapsedTime > (NATS.talkLength * 60000)) c += "overtime ";
    }
    NATS.body.setAttribute("class", c);
  }  
  
  NATS.redrawMils = function(time){
    var mils = 0;
    if(NATS.showMilliseconds){
      mils = (time % 60000) % 1000;
      
      if      (mils ==  0) { mils = '.000'       } 
      else if (mils <  10) { mils = '.00' + mils } 
      else if (mils < 100) { mils = '.0'  + mils }
      else                 { mils = '.'   + mils }

    } else {
      mils = '';
    }
    NATS.milsDiv.innerHTML = mils;
  }

  NATS.reset = function(){
    NATS.elapsedTime = 0;
    NATS.startTime   = new Date();
    NATS.redraw();
  }

  NATS.setDirection = function(){
    NATS.countUp = NATS.directionEl.selectedIndex==0;
    NATS.redraw();
  }

  NATS.start = function(){
    NATS.paused    = false;
    NATS.startTime = new Date((new Date()).getTime() - NATS.elapsedTime); // Adust startTime as needed so that a paused timer can continue accordingly
    NATS.timer     = setInterval(NATS.updateElapsedTime, 10);
  }
    
  NATS.toggleDirection = function(){
    NATS.directionEl.selectedIndex = (NATS.directionEl.selectedIndex==0) ? 1 : 0;
    NATS.setDirection();
  }
  
  NATS.updateElapsedTime = function(){
    NATS.elapsedTime = (new Date()).getTime() - NATS.startTime.getTime();
    NATS.redraw();
  }
  
  window.addEventListener("load", NATS.initialize, false);
  
</script>

<style type="text/css">
body {
  background-color: #000;
  color: #fff;
}

#time {
  display: block;
  font-family: Courier, monospace;
  font-size: 300px;
  font-weight: bold;
  margin: 60px 50px 0 0;
  text-align: right;
}

#counter { letter-spacing: -30px; }
#milliseconds { font-size: 50px; }

#start, 
#pause, 
#reset {
  height: 50px;
  position: absolute;
  top: 5px;
  width: 90px;
}

#start,
#pause {
  left: 5px;
}

#reset {
  right: 5px;
}

#direction { 
  font-size: 15px;
  left: 100px;
  position: absolute;
  top: 5px;
}


#lights {
  float: right;
  margin-right: 50px;
  position: relative;
}

#counting, 
#warning, 
#overtime {
  opacity: 0.05;
}

body.counting #counting,
body.warning  #warning,
body.overtime #overtime {
  opacity: 1.0;
}

#paused { display: none; }

body.paused #paused{
  display: block;
  font-family: Courier, monospace;
  font-size: 100px;
  font-weight: bold;
  letter-spacing: 10px;
  opacity: 1.0;
  position: absolute;
  text-align: center;
  top: 45px;
  width: 100%;
}

#pause { display: none; }
#start { display: inline; }
body.counting #pause { display: inline; }
body.counting #start { display: none; }

</style>

</head>
<body>
   <input type="button" id="start" value="Start" title="Start timer (S)"/>
   <input type="button" id="pause" value="Pause" title="Pause timer (P)" />
   <select id="direction" title="Direction (D)">
     <option>Count up</option>
     <option>Count down</option>
   </select>
   <input type="button" id="reset" value="Reset" title="Reset timer (Esc)"/>
   <div id="time">
     <span id="counter"> </span><span id="milliseconds"> </span>
   </div>
   <div id="lights">
     <img src="greenLight.png"  id="counting"/>
     <img src="yellowLight.png" id="warning"/>
     <img src="redLight.png"    id="overtime"/>
     <div id="paused">(paused)</div>
   </div>
</body>
</html>